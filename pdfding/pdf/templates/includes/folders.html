{% if folders %}
<div x-data="{ {% for folder in folders %}{% if not folder.parent %}folder_{{ folder.id }}_show_children: false, {% endif %}{% endfor %} }">
    <!-- Root folders (folders with no parent) -->
    {% for folder in folders %}
        {% if not folder.parent %}
        <div>
            <div class="flex justify-between items-center relative">
                <a href="{% url 'pdf_overview_query' %}?folder={{ folder.id }}"
                   class="pl-1 pr-2 my-[2px] flex justify-left items-center truncate border rounded-sm
                          border-slate-200 dark:border-slate-800 creme:border-creme-dark-light
                          hover:bg-slate-200 dark:hover:bg-slate-800 creme:hover:bg-creme-dark-light
                          flex-grow
                          {% if current_folder_id == folder.id|stringformat:'s' %} bg-slate-200 dark:bg-slate-800 creme:bg-creme-dark-light {% endif %}"
                   title="{{ folder.name }}">
                    <svg class="w-4 h-4 mr-1 flex-shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 8H21M5 8V5C5 3.89543 5.89543 3 7 3H10.5858C10.851 3 11.1054 3.10536 11.2929 3.29289L13 5H19C20.1046 5 21 5.89543 21 7V18C21 19.1046 20.1046 20 19 20H5C3.89543 20 3 19.1046 3 18V8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="truncate">{{ folder.name }}</span>
                    {% with count=folder.get_pdf_count %}
                    {% if count > 0 %}
                    <span class="ml-auto text-xs text-slate-500 dark:text-slate-400 creme:text-stone-500 flex-shrink-0 ml-2">{{ count }}</span>
                    {% endif %}
                    {% endwith %}
                </a>
                {% if folder.subfolders.exists %}
                <a id="open-children-{{ folder.id }}" class="cursor-pointer"
                   @click="folder_{{ folder.id }}_show_children = !folder_{{ folder.id }}_show_children">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="w-5 h-5 mr-2 text-slate-500! hover:text-black!
                               dark:text-slate-300 dark:hover:text-white! creme:text-stone-400! creme:hover:text-stone-700!"
                        :class="{ 'rotate-90': folder_{{ folder.id }}_show_children }">
                        <path d="m9 18 6-6-6-6"></path>
                    </svg>
                </a>
                {% endif %}
            </div>

            <!-- Nested folders (subfolders) -->
            {% if folder.subfolders.exists %}
            <div x-show="folder_{{ folder.id }}_show_children" x-cloak
                 class="ml-3 border-l-2 border-slate-100 dark:border-slate-700 creme:border-creme-dark-light pl-2">
                {% for subfolder in folder.subfolders.all %}
                <div class="flex justify-between items-center relative">
                    <a href="{% url 'pdf_overview_query' %}?folder={{ subfolder.id }}"
                       class="pl-1 pr-2 my-[2px] flex justify-left items-center truncate border rounded-sm
                              border-slate-200 dark:border-slate-800 creme:border-creme-dark-light
                              hover:bg-slate-200 dark:hover:bg-slate-800 creme:hover:bg-creme-dark-light
                              flex-grow
                              {% if current_folder_id == subfolder.id|stringformat:'s' %} bg-slate-200 dark:bg-slate-800 creme:bg-creme-dark-light {% endif %}"
                       title="{{ subfolder.name }}">
                        <svg class="w-4 h-4 mr-1 flex-shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 8H21M5 8V5C5 3.89543 5.89543 3 7 3H10.5858C10.851 3 11.1054 3.10536 11.2929 3.29289L13 5H19C20.1046 5 21 5.89543 21 7V18C21 19.1046 20.1046 20 19 20H5C3.89543 20 3 19.1046 3 18V8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="truncate">{{ subfolder.name }}</span>
                        {% with count=subfolder.get_pdf_count %}
                        {% if count > 0 %}
                        <span class="ml-auto text-xs text-slate-500 dark:text-slate-400 creme:text-stone-500 flex-shrink-0 ml-2">{{ count }}</span>
                        {% endif %}
                        {% endwith %}
                    </a>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}
    {% endfor %}

    <!-- Root PDFs (PDFs with no folder assigned) -->
    <div>
        <a href="{% url 'pdf_overview_query' %}?folder=root"
           class="pl-1 pr-2 my-[2px] flex justify-left items-center truncate border rounded-sm
                  border-slate-200 dark:border-slate-800 creme:border-creme-dark-light
                  hover:bg-slate-200 dark:hover:bg-slate-800 creme:hover:bg-creme-dark-light
                  flex-grow
                  {% if current_folder_id == 'root' %} bg-slate-200 dark:bg-slate-800 creme:bg-creme-dark-light {% endif %}"
           title="PDFs without a folder">
            <svg class="w-4 h-4 mr-1 flex-shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 8H21M5 8V5C5 3.89543 5.89543 3 7 3H10.5858C10.851 3 11.1054 3.10536 11.2929 3.29289L13 5H19C20.1046 5 21 5.89543 21 7V18C21 19.1046 20.1046 20 19 20H5C3.89543 20 3 19.1046 3 18V8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="truncate">No Folder</span>
            <span class="ml-auto text-xs text-slate-500 dark:text-slate-400 creme:text-stone-500 flex-shrink-0 ml-2">{{ root_pdf_count }}</span>
        </a>
    </div>
</div>
{% endif %}
